<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- 1) head -->
<th:block th:replace="content/layout/header :: header"></th:block>

<!-- 2) body ì‹œì‘ + content-wrapper ì‹œì‘ -->
<th:block th:replace="content/layout/header :: bodyheader"></th:block>


<!-- ===============================
     ë©”ì¸ ë ˆì´ì•„ì›ƒ
================================ -->
<div class="home-wrapper">

    <!-- ìµœì‹  ì½˜í…ì¸  -->
    <div class="left-area">
        <div class="section-title">ìµœì‹  ì½˜í…ì¸ </div>

        <div class="content-grid">
            <div class="post-card"
                 th:each="post : ${latestPosts}"
                 th:onclick="'location.href=\'/content/post/' + ${post.id} + '\';'"
                 th:attr="data-id=${post.id}">

                <div>
                    <div class="post-title" th:text="${post.title}"></div>
                    <!-- ë³¸ë¬¸ ë¯¸ë¦¬ë³´ê¸° -->
                    <div class="post-preview" th:text="${post.preview}"></div>
                </div>

                <div class="post-meta">
                    <span th:text="${#temporals.format(post.createdDate, 'yyyy.MM.dd')}"></span>
                    <span>ğŸ‘ <span th:text="${post.viewCount}"></span></span>
                </div>
            </div>
        </div>
    </div>

    <!-- ë§ì´ ë³¸ ì½˜í…ì¸  -->
    <aside class="sidebar">
        <div class="section-title">ë§ì´ ë³¸ ì½˜í…ì¸ </div>

        <div class="popular-box">
            <div class="popular-item" th:each="post, iter : ${popularPosts}">
                <span class="popular-rank"
                      th:classappend="${iter.index + 1 <= 3} ? ' top3' : ''"
                      th:text="${iter.index + 1}"></span>
                <a th:href="@{'/content/post/' + ${post.id}}"
                   class="popular-title"
                   th:text="${post.title}"></a>
                <div class="popular-view">ì¡°íšŒìˆ˜: <span th:text="${post.viewCount}"></span></div>
            </div>
        </div>
    </aside>

</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {

        // localStorageì—ì„œ ì½ì—ˆë˜ ê¸€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        const readPosts = JSON.parse(localStorage.getItem("readPosts") || "[]");

        // ëª¨ë“  ì¹´ë“œë“¤ ìˆœíšŒ
        document.querySelectorAll(".post-card").forEach(card => {

            const postId = String(card.getAttribute("data-id") || "");

            if (postId && readPosts.includes(postId)) {
                card.classList.add("read-post");
            }
        });
    });
</script>

<!-- ===============================
     Style
================================= -->
<style>
    .post-card.read-post .post-title,
    .post-card.read-post .post-preview {
        color: #999;
    }

    .post-card {
        cursor: pointer;
    }

    .post-title {
        font-size: 1.15rem;
        font-weight: 600;
        margin-bottom: 6px;
    }

    .post-preview {
        font-size: 0.95rem;
        color: #555;
        line-height: 1.35;
        height: 2.7em; /* 2ì¤„ ë†’ì´ */
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2; /* 2ì¤„ í‘œì‹œ */
        -webkit-box-orient: vertical;
        margin-bottom: 10px;
    }

</style>


<!-- 3) footer -->
<th:block th:replace="content/layout/footer :: footer"></th:block>

</html>
