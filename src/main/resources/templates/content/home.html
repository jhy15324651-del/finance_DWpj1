<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- 1) head -->
<th:block th:replace="content/layout/header :: header"></th:block>

<!-- 2) body ì‹œì‘ -->
<th:block th:replace="content/layout/header :: bodyheader"></th:block>

<!-- ===============================
     ë©”ì¸ ë ˆì´ì•„ì›ƒ
================================= -->
<div class="home-wrapper">

    <!-- ìµœì‹  ì½˜í…ì¸  -->
    <div class="left-area">
        <div class="section-title">ìµœì‹  ì½˜í…ì¸ </div>

        <div class="content-grid">
            <div class="post-card"
                 th:each="post : ${latestPosts}"
                 th:onclick="'location.href=\'/content/post/' + ${post.id} + '\';'"
                 th:attr="data-id=${post.id}">

                <!-- ğŸ”¹ ìƒë‹¨: ì œëª© + ë³¸ë¬¸ + ì¸ë„¤ì¼ -->
                <div class="post-main">
                    <!-- ì™¼ìª½ í…ìŠ¤íŠ¸ ì˜ì—­ -->
                    <div class="post-left">
                        <div class="post-title" th:text="${post.title}"></div>

                        <div class="post-preview" th:text="${post.preview}"></div>
                    </div>

                    <!-- ì˜¤ë¥¸ìª½ ì¸ë„¤ì¼ -->
                    <div class="post-thumb">
                        <img th:src="${post.thumbnail} ?: '/images/default-thumbnail.png'" alt="thumbnail">
                    </div>
                </div>

                <!-- ğŸ”¹ í•˜ë‹¨: ì‘ì„±ì/í‰ì  + ë‚ ì§œ/ì¡°íšŒìˆ˜ (ì¹´ë“œ í•˜ë‹¨ ê³ ì •) -->
                <div class="post-bottom">
                    <div class="post-extra">
                        <span th:text="'ì‘ì„±ì: ' + ${post.writer}"></span>
                        <span class="post-rating">
                            â­ <span th:text="${post.ratingAvg} ?: 0.0"></span>
                        </span>
                    </div>

                    <div class="post-meta">
                        <span th:text="${#temporals.format(post.createdDate, 'yyyy.MM.dd')}"></span>
                        <span>ğŸ‘ <span th:text="${post.viewCount}"></span></span>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- ë§ì´ ë³¸ ì½˜í…ì¸  -->
    <aside class="sidebar">
        <div class="section-title">ë§ì´ ë³¸ ì½˜í…ì¸ </div>

        <div class="popular-box">
            <div class="popular-item" th:each="post, iter : ${popularPosts}">
                <span class="popular-rank"
                      th:classappend="${iter.index + 1 <= 3} ? ' top3' : ''"
                      th:text="${iter.index + 1}">
                </span>

                <a th:href="@{'/content/post/' + ${post.id}}"
                   class="popular-title"
                   th:text="${post.title}"></a>

                <div class="popular-view">
                    ì¡°íšŒìˆ˜: <span th:text="${post.viewCount}"></span>
                </div>
            </div>
        </div>
    </aside>

</div>

<!-- ===============================
     ì½ì€ ê¸€ ì²´í¬ìš© JS
================================= -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const readPosts = JSON.parse(localStorage.getItem("readPosts") || "[]");

        document.querySelectorAll(".post-card").forEach(card => {
            const postId = String(card.getAttribute("data-id") || "");
            if (postId && readPosts.includes(postId)) {
                card.classList.add("read-post");
            }
        });
    });
</script>

<!-- ===============================
     Style
================================= -->
<style>
    /* === ì½ì€ ê²Œì‹œê¸€ ìƒ‰ìƒ ì²˜ë¦¬ === */
    .post-card.read-post .post-title,
    .post-card.read-post .post-preview {
        color: #999;
    }

    /* === ì¹´ë“œ ì „ì²´ === */
    .post-card {
        cursor: pointer;
        display: flex;
        flex-direction: column;   /* ìœ„: main, ì•„ë˜: bottom */
        gap: 10px;

        padding: 16px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        margin-bottom: 20px;
        transition: 0.2s ease;
    }

    .post-card:hover {
        transform: translateY(-3px);
    }

    /* === ìƒë‹¨: ì œëª©/ë³¸ë¬¸ + ì¸ë„¤ì¼ === */
    .post-main {
        display: flex;
        justify-content: space-between;
        gap: 18px;
    }

    .post-left {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .post-title {
        font-size: 1.15rem;
        font-weight: 600;
        margin-bottom: 6px;
    }

    /* ë³¸ë¬¸ ë¯¸ë¦¬ë³´ê¸°: í•­ìƒ 2ì¤„ ê³µê°„ í™•ë³´ */
    .post-preview {
        font-size: 0.95rem;
        color: #555;
        line-height: 1.35;
        margin-bottom: 4px;

        max-height: 2.7em;
        min-height: 2.7em;   /* ë³¸ë¬¸ì´ ì—†ì–´ë„ ë™ì¼ ë†’ì´ ìœ ì§€ */
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    /* ì¸ë„¤ì¼ */
    .post-thumb img {
        width: 130px;
        height: 100px;
        object-fit: cover;
        border-radius: 8px;
        flex-shrink: 0;
    }

    /* === í•˜ë‹¨: ì‘ì„±ì/í‰ì  + ë‚ ì§œ/ì¡°íšŒìˆ˜ === */
    .post-bottom {
        display: flex;
        flex-direction: column;
        gap: 4px;
        margin-top: 4px;
    }

    .post-extra {
        font-size: 0.9rem;
        color: #666;
        display: flex;
        gap: 12px;
    }

    .post-rating {
        color: #f5b301;
    }

    .post-meta {
        display: flex;
        justify-content: space-between;  /* ì™¼ìª½: ë‚ ì§œ / ì˜¤ë¥¸ìª½: ì¡°íšŒìˆ˜ */
        align-items: center;
        font-size: 0.85rem;
        color: #666;
    }
</style>

<!-- 3) footer -->
<th:block th:replace="content/layout/footer :: footer"></th:block>

</html>
