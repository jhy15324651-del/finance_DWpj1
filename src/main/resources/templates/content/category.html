<!-- header ë¶ˆëŸ¬ì˜¤ê¸° -->
<th:block th:replace="content/layout/header :: header"></th:block>
<th:block th:replace="content/layout/header :: bodyheader"></th:block>

<div class="category-page">

    <!-- í˜ì´ì§€ ì œëª© -->
    <h2 class="category-title">ì¹´í…Œê³ ë¦¬</h2>

    <!-- ğŸ”¥ íƒœê·¸ + ê²€ìƒ‰ì°½ í†µí•© ë°•ìŠ¤ -->
    <div class="category-tabs-container">

        <!-- â–£ í•´ì‹œíƒœê·¸ ë¦¬ìŠ¤íŠ¸ -->
        <div class="tag-list">

            <!-- ğŸ‘‰ ì´ˆê¸°í™” ë²„íŠ¼ (ì „ì²´ ì´ˆê¸°í™”) -->
            <button type="button"
                    class="category-tab reset-tags-btn">
                ì´ˆê¸°í™”
            </button>

            <!-- ğŸ‘‰ ë°˜ë³µë˜ëŠ” í•´ì‹œíƒœê·¸ ë²„íŠ¼ë“¤ -->
            <button type="button"
                    class="category-tab tag-select-btn"
                    data-tag="#ê³µì§€"
                    th:classappend="${keyword != null and #strings.contains(keyword, '#ê³µì§€')} ? ' active'">
                #ê³µì§€
            </button>

            <button type="button"
                    class="category-tab tag-select-btn"
                    data-tag="#ê±°ì‹œê²½ì œ"
                    th:classappend="${keyword != null and #strings.contains(keyword, '#ê±°ì‹œê²½ì œ')} ? ' active'">
                #ê±°ì‹œê²½ì œ
            </button>

            <button type="button"
                    class="category-tab tag-select-btn"
                    data-tag="#ì›ìœ "
                    th:classappend="${keyword != null and #strings.contains(keyword, '#ì›ìœ ')} ? ' active'">
                #ì›ìœ 
            </button>

            <button type="button"
                    class="category-tab tag-select-btn"
                    data-tag="#ì—”ë¹„ë””ì•„"
                    th:classappend="${keyword != null and #strings.contains(keyword, '#ì—”ë¹„ë””ì•„')} ? ' active'">
                #ì—”ë¹„ë””ì•„
            </button>

            <button type="button"
                    class="category-tab tag-select-btn"
                    data-tag="#í…ŒìŠ¬ë¼"
                    th:classappend="${keyword != null and #strings.contains(keyword, '#í…ŒìŠ¬ë¼')} ? ' active'">
                #í…ŒìŠ¬ë¼
            </button>

        </div>

        <!-- â–£ ê²€ìƒ‰ í¼ -->
        <form th:action="@{/content/category}" method="get" class="search-form-inline">
            <select name="searchType" class="search-select-inline">
                <option value="hashtag" th:selected="${searchType} == 'hashtag'">#í•´ì‹œíƒœê·¸</option>
                <option value="title" th:selected="${searchType} == 'title'">ì œëª©</option>
                <option value="content" th:selected="${searchType} == 'content'">ë‚´ìš©</option>
            </select>

            <input type="text"
                   name="keyword"
                   class="search-input-inline"
                   placeholder="ê²€ìƒ‰ì–´ ì…ë ¥"
                   th:value="${keyword}">

            <button type="submit" class="search-btn-inline">ê²€ìƒ‰</button>
        </form>

    </div> <!-- category-tabs-container END -->


    <!-- ğŸ“„ ê²Œì‹œê¸€ í…Œì´ë¸” -->
    <table class="board-table">
        <thead>
        <tr>
            <th>ë²ˆí˜¸</th>
            <th>ì œëª©</th>
            <th>ì‘ì„±ì¼</th>
            <th>ì¡°íšŒìˆ˜</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="post, iter : ${posts.content}">
            <td th:text="${posts.totalElements - (posts.number * posts.size) - iter.index}"></td>
            <td>
                <a th:href="@{/content/post/{id}(
                            id=${post.id},
                            page=${currentPage},
                            keyword=${keyword},
                            searchType=${searchType}
                      )}"
                   th:text="${post.title}">
                </a>
            </td>
            <td th:text="${#temporals.format(post.createdDate, 'yyyy.MM.dd')}"></td>
            <td th:text="${post.viewCount}"></td>
        </tr>

        <tr th:if="${posts.totalElements == 0}">
            <td colspan="4" style="text-align:center; padding:30px;">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td>
        </tr>
        </tbody>
    </table>


    <!-- ğŸ“Œ í˜ì´ì§• + ê¸€ì“°ê¸° -->
    <div class="page-bottom-area">

        <div class="pagination" th:if="${totalPages > 1}">
            <a th:href="@{/content/category(page=0, keyword=${keyword}, searchType=${searchType})}">â®</a>

            <a th:if="${prevBlock >= 0}"
               th:href="@{/content/category(page=${prevBlock}, keyword=${keyword}, searchType=${searchType})}">â—€</a>

            <a th:each="i : ${#numbers.sequence(blockStart, blockEnd)}"
               th:href="@{/content/category(page=${i}, keyword=${keyword}, searchType=${searchType})}"
               th:text="${i + 1}"
               th:classappend="${i == currentPage} ? 'active-page'">
            </a>

            <a th:if="${nextBlock < totalPages}"
               th:href="@{/content/category(page=${nextBlock}, keyword=${keyword}, searchType=${searchType})}">â–¶</a>

            <a th:href="@{/content/category(page=${totalPages - 1}, keyword=${keyword}, searchType=${searchType})}">â­</a>
        </div>

        <a href="/content/write" class="write-btn">ê¸€ì“°ê¸°</a>
    </div>

</div> <!-- category-page END -->


<!-- ============================= -->
<!-- ğŸ”¥ JS : í•´ì‹œíƒœê·¸ ë©€í‹° ì„ íƒ ê¸°ëŠ¥ -->
<!-- ============================= -->
<script>
    document.addEventListener("DOMContentLoaded", () => {

        const selectedTags = new Set();
        const tagButtons = document.querySelectorAll(".tag-select-btn");
        const resetBtn = document.querySelector(".reset-tags-btn");
        const searchInput = document.querySelector(".search-input-inline");
        const searchTypeSelect = document.querySelector(".search-select-inline");
        const searchForm = document.querySelector(".search-form-inline");

        /* 1ï¸âƒ£ í˜ì´ì§€ ë¡œë“œ ì‹œ: keywordì—ì„œ íƒœê·¸ ë³µì› */
        if (searchInput && searchInput.value.trim().length > 0) {
            searchInput.value.split(" ")
                .map(t => t.trim())
                .filter(t => t.startsWith("#"))
                .forEach(tag => selectedTags.add(tag));

            tagButtons.forEach(btn => {
                const tag = btn.dataset.tag;
                if (selectedTags.has(tag)) {
                    btn.classList.add("active");
                }
            });
        }

        /* 2ï¸âƒ£ íƒœê·¸ í´ë¦­ ì‹œ ì„ íƒ/í•´ì œ + ê²€ìƒ‰ì°½ ì—…ë°ì´íŠ¸ + ìë™ submit */
        tagButtons.forEach(btn => {
            btn.addEventListener("click", () => {
                const tag = btn.dataset.tag;

                if (selectedTags.has(tag)) {
                    selectedTags.delete(tag);
                    btn.classList.remove("active");
                } else {
                    selectedTags.add(tag);
                    btn.classList.add("active");
                }

                searchInput.value = Array.from(selectedTags).join(" ");
                searchTypeSelect.value = "hashtag";
                searchForm.submit();
            });
        });

        /* 3ï¸âƒ£ ì´ˆê¸°í™” ë²„íŠ¼ í´ë¦­ â†’ ì „ì²´ ë¦¬ì…‹ */
        resetBtn.addEventListener("click", () => {
            selectedTags.clear();

            tagButtons.forEach(btn => btn.classList.remove("active"));

            searchInput.value = "";
            searchForm.submit();
        });

    });
</script>

<style>
    .board-table th,
    .board-table td {
        text-align: center;
    }
</style>


<!-- footer í¬í•¨ -->
<th:block th:replace="content/layout/footer :: footer"></th:block>
