<!-- 1ï¸âƒ£ head: header-main ì‚¬ìš© -->
<th:block th:replace="content/layout/header-main :: header-main"></th:block>

<!-- 2ï¸âƒ£ ê³µí†µ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<th:block th:replace="content/layout/header-main :: bodyheader"></th:block>

<div class="content-tabs">
    <a href="/content/home" class="tab">ë©”ì¸ìœ¼ë¡œ</a>
    <a href="/content/category" class="tab active">ì¹´í…Œê³ ë¦¬</a>
    <a href="/content/info" class="tab">í”„ë¡œí•„</a>
</div>

<div class="category-page">

    <!-- í˜ì´ì§€ ì œëª© -->
    <h2 class="category-title">ì¹´í…Œê³ ë¦¬</h2>

    <!-- ğŸ”¥ íƒœê·¸ + ê²€ìƒ‰ì°½ í†µí•© ë°•ìŠ¤ -->
    <div class="category-tabs-container">

        <!-- â–£ í•´ì‹œíƒœê·¸ ë¦¬ìŠ¤íŠ¸ -->
        <div class="tag-list">

            <!-- ğŸ‘‰ ì´ˆê¸°í™” ë²„íŠ¼ -->
            <button type="button" class="category-tab reset-tags-btn">ì´ˆê¸°í™”</button>

            <!-- ğŸ‘‰ ë°˜ë³µë˜ëŠ” í•´ì‹œíƒœê·¸ ë²„íŠ¼ë“¤ -->
            <button type="button" class="category-tab tag-select-btn"
                    data-tag="#ê³µì§€"
                    th:classappend="${keyword != null and #strings.contains(keyword, '#ê³µì§€')} ? ' active'">
                #ê³µì§€
            </button>

            <button type="button" class="category-tab tag-select-btn"
                    data-tag="#ê±°ì‹œê²½ì œ"
                    th:classappend="${keyword != null and #strings.contains(keyword, '#ê±°ì‹œê²½ì œ')} ? ' active'">
                #ê±°ì‹œê²½ì œ
            </button>

            <button type="button" class="category-tab tag-select-btn"
                    data-tag="#ì›ìœ "
                    th:classappend="${keyword != null and #strings.contains(keyword, '#ì›ìœ ')} ? ' active'">
                #ì›ìœ 
            </button>

            <button type="button" class="category-tab tag-select-btn"
                    data-tag="#ì—”ë¹„ë””ì•„"
                    th:classappend="${keyword != null and #strings.contains(keyword, '#ì—”ë¹„ë””ì•„')} ? ' active'">
                #ì—”ë¹„ë””ì•„
            </button>

            <button type="button" class="category-tab tag-select-btn"
                    data-tag="#í…ŒìŠ¬ë¼"
                    th:classappend="${keyword != null and #strings.contains(keyword, '#í…ŒìŠ¬ë¼')} ? ' active'">
                #í…ŒìŠ¬ë¼
            </button>

            <button type="button" class="category-tab tag-select-btn"
                    data-tag="#ì´ˆë³´"
                    th:classappend="${keyword != null and #strings.contains(keyword, '#ì´ˆë³´')} ? ' active'">
                #ì´ˆë³´
            </button>

            <button type="button" class="category-tab tag-select-btn"
                    data-tag="#ì‹¤ì „ì „ëµ"
                    th:classappend="${keyword != null and #strings.contains(keyword, '#ì‹¤ì „ì „ëµ')} ? ' active'">
                #ì‹¤ì „ì „ëµ
            </button>

            <button type="button" class="category-tab tag-select-btn"
                    data-tag="#ì¥ê¸°íˆ¬ì"
                    th:classappend="${keyword != null and #strings.contains(keyword, '#ì¥ê¸°íˆ¬ì')} ? ' active'">
                #ì¥ê¸°íˆ¬ì
            </button>

        </div>

        <!-- â–£ ê²€ìƒ‰ í¼ -->
        <form th:action="@{/content/category}" method="get" class="search-form-inline">
            <select name="searchType" class="search-select-inline">
                <option value="hashtag" th:selected="${searchType} == 'hashtag'">#í•´ì‹œíƒœê·¸</option>
                <option value="title" th:selected="${searchType} == 'title'">ì œëª©</option>
                <option value="content" th:selected="${searchType} == 'content'">ë‚´ìš©</option>
                <option value="writer" th:selected="${searchType} == 'writer'">ì‘ì„±ì</option>
            </select>

            <input type="text" name="keyword" class="search-input-inline"
                   th:value="${keyword}" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">

            <button type="submit" class="search-btn-inline">ê²€ìƒ‰</button>
        </form>

    </div> <!-- category-tabs-container END -->


    <!-- ğŸ“„ ê²Œì‹œê¸€ í…Œì´ë¸” -->
    <table class="board-table">
        <colgroup>
            <col style="width: 80px;">     <!-- ë²ˆí˜¸ -->
            <col style="width: auto;">     <!-- ì œëª© (ê°€ë³€, ellipsis ì ìš©) -->
            <col style="width: 140px;">    <!-- ì‘ì„±ì -->
            <col style="width: 150px;">    <!-- ì‘ì„±ì¼ -->
            <col style="width: 100px;">    <!-- ì¡°íšŒìˆ˜ -->
        </colgroup>

        <thead>
        <tr>
            <th>ë²ˆí˜¸</th>
            <th>ì œëª©</th>
            <th>ì‘ì„±ì</th> <!-- ğŸ”¥ ì¶”ê°€ -->
            <th>ì‘ì„±ì¼</th>
            <th>ì¡°íšŒìˆ˜</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="post, iter : ${posts.content}">
            <!-- ë²ˆí˜¸ -->
            <td th:text="${posts.totalElements - (posts.number * posts.size) - iter.index}"></td>

            <!-- ì œëª© -->
            <td class="table-title">
                <a th:href="@{/content/post/{id}(
                        id=${post.id},
                        page=${currentPage},
                        keyword=${keyword},
                        searchType=${searchType}
                )}"
                   th:text="${post.title}"
                   th:title="${post.title}">
                </a>
            </td>

            <!-- ğŸ”¥ ì‘ì„±ì ì¶œë ¥ -->
            <td th:text="${post.writer != null ? post.writer : 'ìµëª…'}"></td>

            <!-- ì‘ì„±ì¼ -->
            <td th:text="${#temporals.format(post.createdDate, 'yyyy.MM.dd')}"></td>

            <!-- ì¡°íšŒìˆ˜ -->
            <td th:text="${post.viewCount}"></td>
        </tr>

        <!-- ê²Œì‹œê¸€ì´ ì—†ì„ ë•Œ -->
        <tr th:if="${posts.totalElements == 0}">
            <td colspan="5" style="text-align:center; padding:30px;">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td>
        </tr>
        </tbody>
    </table>


    <!-- ğŸ“Œ í˜ì´ì§• + ê¸€ì“°ê¸° -->
    <div class="page-bottom-area">

        <!-- í˜ì´ì§• -->
        <div class="pagination" th:if="${totalPages > 1}">
            <a th:href="@{/content/category(page=0, keyword=${keyword}, searchType=${searchType})}">â®</a>

            <a th:if="${prevBlock >= 0}"
               th:href="@{/content/category(page=${prevBlock}, keyword=${keyword}, searchType=${searchType})}">â—€</a>

            <a th:each="i : ${#numbers.sequence(blockStart, blockEnd)}"
               th:href="@{/content/category(page=${i}, keyword=${keyword}, searchType=${searchType})}"
               th:text="${i + 1}"
               th:classappend="${i == currentPage} ? 'active-page'"></a>

            <a th:if="${nextBlock < totalPages}"
               th:href="@{/content/category(page=${nextBlock}, keyword=${keyword}, searchType=${searchType})}">â–¶</a>

            <a th:href="@{/content/category(page=${totalPages - 1}, keyword=${keyword}, searchType=${searchType})}">â­</a>
        </div>

        <!-- ğŸ”¥ ê¸€ì“°ê¸° ë²„íŠ¼ (ë¡œê·¸ì¸ ì—¬ë¶€ë¡œ ì œì–´) -->
        <div>
            <a th:if="${nickname != null}" href="/content/write" class="write-btn">ê¸€ì“°ê¸°</a>
            <a th:if="${nickname == null}" href="/user/login" class="write-btn">ë¡œê·¸ì¸ í›„ ê¸€ì“°ê¸°</a>
        </div>

    </div>

</div> <!-- category-page END -->


<!-- ============================= -->
<!-- ğŸ”¥ JS : í•´ì‹œíƒœê·¸ ë©€í‹° ì„ íƒ ê¸°ëŠ¥ -->
<!-- ============================= -->
<script>
    document.addEventListener("DOMContentLoaded", () => {

        const selectedTags = new Set();
        const tagButtons = document.querySelectorAll(".tag-select-btn");
        const resetBtn = document.querySelector(".reset-tags-btn");
        const searchInput = document.querySelector(".search-input-inline");
        const searchTypeSelect = document.querySelector(".search-select-inline");
        const searchForm = document.querySelector(".search-form-inline");

        /* 1ï¸âƒ£ í˜ì´ì§€ ë¡œë“œ ì‹œ: keywordì—ì„œ íƒœê·¸ ë³µì› */
        if (searchInput && searchInput.value.trim().length > 0) {
            searchInput.value.split(" ")
                .map(t => t.trim())
                .filter(t => t.startsWith("#"))
                .forEach(tag => selectedTags.add(tag));

            tagButtons.forEach(btn => {
                const tag = btn.dataset.tag;
                if (selectedTags.has(tag)) {
                    btn.classList.add("active");
                }
            });
        }

        /* 2ï¸âƒ£ íƒœê·¸ í´ë¦­ ì‹œ ì„ íƒ/í•´ì œ + ê²€ìƒ‰ì°½ ì—…ë°ì´íŠ¸ + ìë™ submit */
        tagButtons.forEach(btn => {
            btn.addEventListener("click", () => {
                const tag = btn.dataset.tag;

                if (selectedTags.has(tag)) {
                    selectedTags.delete(tag);
                    btn.classList.remove("active");
                } else {
                    selectedTags.add(tag);
                    btn.classList.add("active");
                }

                searchInput.value = Array.from(selectedTags).join(" ");
                searchTypeSelect.value = "hashtag";
                searchForm.submit();
            });
        });

        /* 3ï¸âƒ£ ì´ˆê¸°í™” ë²„íŠ¼ í´ë¦­ â†’ ì „ì²´ ë¦¬ì…‹ */
        resetBtn.addEventListener("click", () => {
            selectedTags.clear();
            tagButtons.forEach(btn => btn.classList.remove("active"));

            searchInput.value = "";
            searchForm.submit();
        });

    });
</script>

<style>

    /* ================================
       ê²Œì‹œê¸€ ì œëª© ë§í¬ ìƒ‰ìƒ ì œì–´
       ë°©ë¬¸ ì „ = ê²€ì •
       ë°©ë¬¸ í›„ = ë³´ë¼ìƒ‰
       hover = íŒŒë€ìƒ‰
       ================================= */

    /* ê¸°ë³¸ ë§í¬ ìƒ‰ìƒ (ë°©ë¬¸ ì „) */
    .board-table a:link {
        color: #222;
        text-decoration: none;
    }

    /* ë°©ë¬¸í•œ ë§í¬ ìƒ‰ìƒ */
    .board-table a:visited {
        color: #8b4cf5; /* ë³´ë¼ìƒ‰ */
    }

    /* ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ */
    .board-table a:hover {
        color: #0070f3; /* íŒŒë€ìƒ‰ */
    }

    /* í´ë¦­ ì‹œ(active) */
    .board-table a:active {
        color: #4b2ca6;
    }

    /* ===============================
       ì½˜í…ì¸  ë¦¬ë·° ì „ìš© íƒ­ (ìµœì¢…)
    ================================ */

    .content-tabs {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 16px auto 0px;
        max-width: 1200px;
        border-bottom: 2px solid #e2e8f0;
    }

    /* íƒ­ ê¸°ë³¸ */
    .content-tabs .tab {
        padding: 15px 30px;
        background: transparent;
        border: none;
        font-size: 1.05rem;
        font-weight: 600;
        cursor: pointer;
        color: #718096;
        text-decoration: none;

        /* í•µì‹¬ */
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
    }

    /* hover */
    .content-tabs .tab:hover {
        color: #667eea;
    }

    /* í™œì„± íƒ­ */
    .content-tabs .tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
    }



</style>


<!-- footer -->
<th:block th:replace="content/layout/footer :: footer"></th:block>
