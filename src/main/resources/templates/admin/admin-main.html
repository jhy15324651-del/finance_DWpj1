<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 페이지</title>
    <link rel="stylesheet" th:href="@{/css/admin/admin-main.css}">
</head>
<body>
<div class="admin-container">
    <!-- 헤더 -->
    <header class="admin-header">
        <div class="header-left">
            <h1>📊 Finance 관리자 페이지</h1>
        </div>
        <div class="header-right">
            <span class="user-info" sec:authentication="name">관리자</span>
            <a th:href="@{/}" class="btn-link">메인으로</a>
            <form th:action="@{/user/logout}" method="post" style="display: inline;">
                <button type="submit" class="btn-logout">로그아웃</button>
            </form>
        </div>
    </header>

    <!-- 탭 네비게이션 -->
    <nav class="admin-tabs">
        <button type="button" class="tab-btn active" data-tab="twitter">
            🐦 트위터 관리
        </button>
        <button type="button" class="tab-btn" data-tab="portfolio">
            💼 포트폴리오 관리
        </button>
        <button  type="button" class="tab-btn" data-tab="news">
            📰 뉴스 관리
        </button>
        <button type="button" class="tab-btn" data-tab="content">
            📝 콘텐츠리뷰 관리
        </button>
        <!-- 확장 가능 공간 -->
    </nav>

    <!-- 탭 컨텐츠 영역 -->
    <main class="admin-main">

        <!-- 트위터 관리 탭 -->
        <div class="tab-content active" id="twitter-tab">
            <div class="tab-header">
                <h2>트위터 인사이트 관리</h2>
                <div class="header-buttons">
                    <button type="button" class="btn-primary" onclick="openAddModal()">+ 새 트윗 추가</button>
                    <button type="button" class="btn-secondary" onclick="initializeDummyData()">더미 데이터 초기화</button>
                </div>
            </div>

            <div class="stats-section">
                <div class="stat-card">
                    <div class="stat-label">전체 트윗</div>
                    <div class="stat-value" id="total-count">0</div>
                </div>
            </div>

            <div class="content-section">
                <h3>트윗 목록</h3>
                <div id="tweet-list" class="tweet-list">
                    <div class="loading">로딩 중...</div>
                </div>
            </div>
        </div>

        <!-- 포트폴리오 관리 탭 -->
        <div class="tab-content" id="portfolio-tab">
            <div class="tab-header">
                <h2>포트폴리오 관리</h2>
            </div>

            <div class="stats-section">
                <div class="stat-card">
                    <div class="stat-label">등록된 투자자</div>
                    <div class="stat-value" id="investor-count">10</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">13F 보유 종목</div>
                    <div class="stat-value" id="holdings-count">0</div>
                </div>
            </div>

            <div class="content-section">
                <h3>13F 데이터 수집</h3>
                <p class="description">
                    SEC 13F 보고서에서 투자대가들의 포트폴리오 데이터를 수집합니다.<br>
                    <small>※ SEC API 호출로 시간이 소요될 수 있습니다 (약 2-5분)</small>
                </p>

                <div class="action-buttons">
                    <button type="button" class="btn-primary btn-large" onclick="start13FCollection()">
                        ▶️ 13F 데이터 수집 시작
                    </button>
                    <button type="button" class="btn-danger btn-large" onclick="stop13FCollection()">
                        ⏸️ 수집 중단
                    </button>
                </div>

                <div id="fetch-status" class="fetch-status"></div>

                <div class="investor-list">
                    <h4>개별 투자자 데이터 수집</h4>
                    <div class="investor-grid">
                        <button type="button" class="investor-btn" onclick="fetch13FData('buffett')">Warren Buffett</button>
                        <button type="button" class="investor-btn" onclick="fetch13FData('wood')">Cathie Wood</button>
                        <button type="button" class="investor-btn" onclick="fetch13FData('dalio')">Ray Dalio</button>
                        <button type="button" class="investor-btn" onclick="fetch13FData('soros')">George Soros</button>
                        <button type="button" class="investor-btn" onclick="fetch13FData('lynch')">Peter Lynch</button>
                        <button type="button" class="investor-btn" onclick="fetch13FData('graham')">Benjamin Graham</button>
                        <button type="button" class="investor-btn" onclick="fetch13FData('thiel')">Peter Thiel</button>
                        <button type="button" class="investor-btn" onclick="fetch13FData('fink')">Larry Fink</button>
                        <button type="button" class="investor-btn" onclick="fetch13FData('simons')">Jim Simons</button>
                        <button type="button" class="investor-btn" onclick="fetch13FData('ackman')">Bill Ackman</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 뉴스 관리 탭 -->
        <div class="tab-content" id="news-tab">
            <div class="tab-header">
                <h2>뉴스 관리</h2>
                <div class="header-buttons">
                    <button type="button" class="btn-secondary" onclick="checkUntranslatedNews()">🔍 번역 안 된 뉴스 확인</button>
                    <button type="button" class="btn-primary" onclick="retranslateNews()">🔄 번역 안 된 뉴스 재번역</button>
                </div>
            </div>
            <p style="font-size: 0.9em; color: #666; margin-top: -10px; margin-bottom: 15px;">
                정책 위반 뉴스를 삭제할 수 있습니다. 삭제된 뉴스는 30일 후 자동으로 영구 삭제됩니다.
            </p>

            <div class="stats-section">
                <div class="stat-card">
                    <div class="stat-label">전체 뉴스</div>
                    <div class="stat-value" id="news-total-count">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">삭제된 뉴스</div>
                    <div class="stat-value" id="news-deleted-count" style="color: #dc3545;">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">번역 안 된 뉴스</div>
                    <div class="stat-value" id="news-untranslated-count" style="color: #fd7e14;">-</div>
                </div>
            </div>

            <div class="content-section">
                <h3>뉴스 목록</h3>
                <div class="table-wrapper">
                    <table class="data-table" id="news-table">
                        <thead>
                            <tr>
                                <th style="width: 60px;">ID</th>
                                <th>제목</th>
                                <th style="width: 120px;">출처</th>
                                <th style="width: 150px;">작성일</th>
                                <th style="width: 100px;">상태</th>
                                <th style="width: 100px;">작업</th>
                            </tr>
                        </thead>
                        <tbody id="news-list">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">
                                    로딩 중...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 콘텐츠리뷰 관리 탭 -->
        <div class="tab-content" id="content-tab">
            <div class="tab-header">
                <h2>콘텐츠리뷰 관리</h2>
                <p style="font-size: 0.9em; color: #666; margin-top: 5px;">
                    정책 위반 콘텐츠 리뷰를 삭제할 수 있습니다. 삭제된 콘텐츠는 30일 후 자동으로 영구 삭제됩니다.
                </p>
            </div>

            <div class="stats-section">
                <div class="stat-card">
                    <div class="stat-label">전체 콘텐츠</div>
                    <div class="stat-value" id="content-total-count">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">삭제된 콘텐츠</div>
                    <div class="stat-value" id="content-deleted-count" style="color: #dc3545;">0</div>
                </div>
            </div>

            <div class="content-section">
                <h3>콘텐츠 리뷰 목록</h3>
                <div class="table-wrapper">
                    <table class="data-table" id="content-table">
                        <thead>
                            <tr>
                                <th style="width: 60px;">ID</th>
                                <th>제목</th>
                                <th style="width: 120px;">작성자</th>
                                <th style="width: 150px;">작성일</th>
                                <th style="width: 100px;">상태</th>
                                <th style="width: 100px;">작업</th>
                            </tr>
                        </thead>
                        <tbody id="content-list">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">
                                    로딩 중...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </main>
</div>

<!-- 트윗 추가/수정 모달 (트위터 탭용) -->
<div id="tweetModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 id="modal-title">새 트윗 추가</h2>

        <form id="tweet-form">
            <input type="hidden" id="tweet-id">

            <div class="form-group">
                <label for="tweet-name">이름 *</label>
                <input type="text" id="tweet-name" required placeholder="예: Cathie Wood">
            </div>

            <div class="form-group">
                <label for="tweet-handle">핸들 (@username) *</label>
                <input type="text" id="tweet-handle" required placeholder="예: CathieDWood">
            </div>

            <div class="form-group">
                <label for="tweet-avatar">아바타 URL</label>
                <input type="text" id="tweet-avatar" placeholder="프로필 이미지 URL">
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="tweet-verified">
                    인증 계정
                </label>
            </div>

            <div class="form-group">
                <label for="tweet-original">원문 (영어) *</label>
                <textarea id="tweet-original" required rows="4" placeholder="영어 원문을 입력하세요"></textarea>
            </div>

            <div class="form-group">
                <label for="tweet-translated">번역 (한국어) *</label>
                <textarea id="tweet-translated" required rows="4" placeholder="한국어 번역을 입력하세요"></textarea>
            </div>

            <div class="form-group">
                <label for="tweet-date">날짜 표시</label>
                <input type="text" id="tweet-date" placeholder="예: 2시간 전, 1일 전">
            </div>

            <div class="form-group">
                <label for="tweet-url">트윗 URL</label>
                <input type="text" id="tweet-url" placeholder="https://twitter.com/...">
            </div>

            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="closeModal()">취소</button>
                <button type="submit" class="btn-primary">저장</button>
            </div>
        </form>
    </div>
</div>

<!-- 삭제 확인 모달 (뉴스/콘텐츠 공통) -->
<div id="deleteModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <span class="close" onclick="closeDeleteModal()">&times;</span>
        <h2>정말 삭제하시겠습니까?</h2>

        <div style="margin: 20px 0; padding: 15px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107;">
            <p style="margin: 0; color: #856404;">
                삭제된 콘텐츠는 30일 후 자동으로 영구 삭제됩니다.
            </p>
        </div>

        <div class="form-group">
            <label for="delete-reason">삭제 사유 *</label>
            <textarea id="delete-reason" rows="4" placeholder="삭제 사유를 입력해주세요 (필수)" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
        </div>

        <div class="form-actions" style="margin-top: 20px;">
            <button type="button" class="btn-secondary" onclick="closeDeleteModal()">취소</button>
            <button type="button" class="btn-danger" onclick="confirmDelete()">삭제</button>
        </div>
    </div>
</div>

<script th:src="@{/js/admin/admin-main.js}"></script>
<script th:src="@{/js/admin/admin-news.js}"></script>
<script th:src="@{/js/admin/admin-content.js}"></script>
</body>
</html>