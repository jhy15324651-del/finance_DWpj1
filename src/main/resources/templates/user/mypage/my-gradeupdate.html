<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ë“±ê¸‰ ì—…ë°ì´íŠ¸ - Finance DW</title>

    <style>
        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ê³µí†µ ì¹´ë“œ ìŠ¤íƒ€ì¼ (ê¸°ì¡´ ë§ˆì´í˜ì´ì§€ ê¸°ë°˜) */
        .card {
            text-align: center;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            overflow:hidden;
        }

        .section-title {
            font-size: 22px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            font-weight: 700;
        }

        .grade-box {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: #f8f9ff;
            border: 2px solid #ececff;
            border-radius: 16px;
        }

        .grade-text {
            text-align: center;
            font-size: 28px;
            font-weight: 600;
            color: #444;
        }

        .grade-emoji {
            font-size: 70px;
        }


        .upload-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .upload-box {
            width: 70%;
            max-width: 600px;
            background: #fafaff;
            border: 2px dashed #c6c6ff;
            border-radius: 12px;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }

        .upload-placeholder {
            color: #555;
        }

        .preview-image {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 8px;
            display: block;
            margin: 0 auto 10px auto;
        }

        .upload-label {
            display: inline-block;
            margin-top: 15px;
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
        }

        .upload-box:hover {
            border-color: #7c3aed;
            background: #eef1ff;
        }

        .upload-box input {
            display: none;
        }


        .btn-update {
            padding: 14px 30px;
            margin-top: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
        }



        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .tier-item {
            text-align: center;
            padding: 25px;
            border-radius: 22px;
            background: #f8f9ff;
            border: 1px solid #e4e6ff;
            font-size: 18px;
        }

        .home-link {
            text-align: center;
            margin-top: 20px;
        }
        .home-link a {
            color: white;
            font-size: 15px;
            opacity: 0.9;
            text-decoration: none;
        }

        .home-link a:hover {
        opacity: 1;
        }





    </style>
</head>

<body>
<div class="container">

    <!-- ë“±ê¸‰ í‘œì‹œ ì¹´ë“œ -->
    <div class="card">
        <div class="section-title">ë‚˜ì˜ í˜„ì¬ ë“±ê¸‰</div>

        <div class="grade-box">
            <div class="grade-emoji" id="gradeEmoji" th:text="${medal}">ğŸ”¥</div>
        </div>
    </div>

    <div class="card">
        <div class="section-title">ë“±ê¸‰ ì—…ë°ì´íŠ¸</div>

        <div class="upload-wrapper">  <!-- ê°€ìš´ë° ì •ë ¬ë˜ëŠ” ë°•ìŠ¤ -->

            <div class="upload-box" id="uploadBox">

                <div class="upload-placeholder" id="placeholder">
                    <span>ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ</span>
                    <p>íŒë§¤ ìˆ˜ìµ / ìˆ˜ìµë¥  ìº¡ì²˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ë“±ê¸‰ì´ ê°±ì‹ ë©ë‹ˆë‹¤</p>
                </div>

                <img id="previewImage" class="preview-image" style="display:none;"/>

                <label for="fileInput" class="upload-label">íŒŒì¼ ì„ íƒ</label>
                <input type="file" id="fileInput" accept="image/*">
            </div>


            <button type="button" class="btn-update" onclick="uploadGrade()">ë“±ê¸‰ ê°±ì‹ í•˜ê¸°</button>
        </div>
    </div>

    <!-- ë“±ê¸‰ ê¸°ì¤€ ì•ˆë‚´ -->
    <div class="card">
        <div class="section-title">ë“±ê¸‰ ê¸°ì¤€ ì•ˆë‚´</div>

        <div class="menu-grid">
            <div class="tier-item">ğŸ’° - íŒë§¤ìˆ˜ìµ 20,000,000ì› ì´ìƒ</div>
            <div class="tier-item">ğŸ’¸ - íŒë§¤ìˆ˜ìµ 10,000,000ì› ì´ìƒ</div>
            <div class="tier-item">ğŸ’µ - íŒë§¤ìˆ˜ìµ ë³¸ì „ ì´ìƒ</div>
            <div class="tier-item">ğŸ’€ - ë§ˆì´ë„ˆìŠ¤</div>
            <div class="tier-item">ğŸ’ - ì£¼ì‹ ìˆ˜ìµë¥  30% ì´ìƒ</div>
            <div class="tier-item">ğŸ… - ì£¼ì‹ ìˆ˜ìµë¥  15% ì´ìƒ</div>
            <div class="tier-item">ğŸ¥ˆ - ì£¼ì‹ ìˆ˜ìµë¥  ë³¸ì „ ì´ìƒ</div>
            <div class="tier-item">ğŸ„ - ë§ˆì´ë„ˆìŠ¤</div>
        </div>
    </div>

    <div class="home-link">
        <a href="/user/mypage">â† ë§ˆì´í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

</div>

<script>
    async function uploadGrade() {

        const file = document.getElementById("fileInput").files[0];
        if (!file) {
            alert("ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.");
            return;
        }

        const formData = new FormData();
        formData.append("file", file);

        try {
            const res = await fetch("/user/mypage/grade/update", {
                method: "POST",
                body: formData
            });

            if (!res.ok) {
                alert("ì—…ë¡œë“œ ì‹¤íŒ¨");
                return;
            }

            const result = await res.json();

            // í™”ë©´ì— ë°˜ì˜
            document.getElementById("gradeEmoji").innerText = result.medal;

            alert("ë“±ê¸‰ì´ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤!");

        } catch (e) {
            console.error(e);
            alert("ì˜¤ë¥˜ ë°œìƒ");
        }
    }

    document.getElementById("fileInput").addEventListener("change", function(event) {
        const file = event.target.files[0];
        const preview = document.getElementById("previewImage");
        const placeholder = document.getElementById("placeholder");

        if (!file) {
            preview.style.display = "none";
            placeholder.style.display = "block";
            return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
            preview.src = e.target.result;

            // ğŸ”¥ ë°•ìŠ¤ ì•ˆì˜ ë¬¸êµ¬ ìˆ¨ê¸°ê³  ë¯¸ë¦¬ë³´ê¸°ë§Œ í‘œì‹œ
            placeholder.style.display = "none";
            preview.style.display = "block";
        }
        reader.readAsDataURL(file);
    });


</script>

</body>
</html>
